\chapter{Scenarios}\label{sec:scenarios}
\todo{Write test here to introduce the chapter!}
Unless otherwise noted, we use the constants
\begin{align}
\begin{split}
  \gamma &= 1.4, \\
  \Pr &= 0.7, \\
  c_v &= 1.0
\end{split}
\end{align}
The other constants follow from the definition of \cref{eq:fluid-constants}.

We describe some scenarios in terms of the primitive variables $(\Qrho, \Qv, \pressure)$, these can be converted to the conservative variables by the definition of momentum and the definition of energy.   

\begin{table}[htb]
  \centering
\caption{Overview of scenarios}%
\label{tab:scenarios}
\begin{tabular}{@{}lrrrr@{}}
\toprule
{Name} & {Analytic Solution} & {Gravity} & {Coupling} & {Limiting}\\ \midrule
Manufactured Solution & \cmark{} & \xmark{} & \xmark{} & \xmark{} \\
Taylor-Green Vortex & \cmark{} & \xmark{} & \xmark{} & \xmark{} \\
\textsc{ABC}-Flow & \cmark{} & \xmark{} & \xmark{} & \xmark{} \\
\textsc{CJ}-Detonation & \xmark{} & \xmark{} & \cmark{} & \cmark{} \\
Two Bubbles & \xmark{} & \cmark{} & \xmark{} & \xmark{} \\
Cosine Bubble & \xmark{} & \cmark{} & \xmark{} & \xmark{} \\
\bottomrule
\end{tabular}
\end{table}

\section{A Manufactured Solution}\label{sec:manufactured-solution}
Following~\cite{dumbser2010arbitrary}, the scenario can be described in primitive variables by setting
\begin{align}
\begin{split}
  \pressure(\bm{x}, t) &= \pressure_0 \cos( \bm{k} \bm{x} - \omega t ) + \pressure_b, \\
  \Qrho(\bm{x}, t) &= \Qrho_0 \sin (\bm{k} \bm{x} - \omega t) + \Qrho_b, \\
  \Qv(\bm{x}, t) &= \bm{v_0} \sin(\bm{k} \bm{x} - \omega t).
\end{split}
\end{align}
We set the constants to \( \left(  \pressure_0 = 0.1, \pressure_b = \gamma^{-1}, \Qrho_0 = 0.5, \Qrho_b = 1, 
\bm{v_0} = 0.25 {(1,1)}^\intercal, \bm{k} = \pi/5 {(1,1)}^\intercal \right) \).

We derive a source term by inserting this solution into the \textsc{pde} by using the symbolic math toolkit \textit{Sage}~\cite{sagemath}.
This procedure is called method of manufactured solutions~\cite{salari2000code}.

\section{Classical Scenarios}
In addition to the convergence test, we use standard \textsc{cfd} scenarios to evaluate our simulations.

% \subsection{The first Stokes Problem}
% \todo{Do I actually want to include this? Bit boring scenario}
% \cite{dumbser2010arbitrary}

\sidetitle{Taylor-Green Vortex}
%\subsection{Taylor-Green Vortex}
An interesting testing scenario is the Taylor-Green Vortex, which exhibits a complicated flow from a simple initial condition.
It is an analytic solution for the incompressible Navier-Stokes equations which agree relatively well with our equation set at low Mach numbers.
We can thus use it to evaluate the performance of our solver.
The solution is
\begin{align}
  \label{eq:taylor-green}
  \begin{split}
  \Qrho(\bm{x}, t) &= 1\\
  \Qv(\bm{x}, t) &= \exp(-2 \mu t)
  \begin{pmatrix}
    \phantom{-}\sin(x) cos(y) \\
- \cos(x) sin(y) 
    \end{pmatrix} \\
  \pressure(\bm{x}, t) &= \exp(-4 \mu t) \, \frac{1}{4} \left( \cos(2x) + \cos(2y) \right) + C
  \end{split}
\end{align}
where $C = 100/\gamma$ is a constant that governs the speed of sound and thus the Mach number~\cite{dumbser2016high}.

As initial conditions we use \cref{eq:taylor-green} at time $(t = 0)$ and as boundary conditions we impose the solution and the corresponding gradients.

\sidetitle{Lid-Driven Cavity Flow}
%\subsection{Lid-Driven Cavity Flow}
The lid-driven cavity flow is another very simple testing scenario for the Navier-Stokes equations.
The flow is driven entirely by the boundary conditions.
They consist in four no-slip walls where the upper wall has a constant velocity $\Qv = (1.0, 0)$.
We want to simulate a flow with a Mach number of $M = 0.1$ and a Reynolds number of $\text{Re} = 100$.
This leads us to an initial conditions of
\begin{align}
  \label{eq:taylor-green}
  \begin{split}
  \Qrho(\bm{x}) &= 1\\
  \Qv(\bm{x}) &=  \bm{0}\\
  \pressure(\bm{x}) &= \frac{100}{\gamma}.
  \end{split}
\end{align}
% Mach = u/speed of sound
% c^2 = gamma p
% p = (u/M)^2 / gamma
This scenario is surprisingly difficult for an \textsc{ader-dg} scheme as the boundary conditions can lead to a discontinuity at the corners, because the wall speed is discontinuous.
Therefore, this scenario is a good choice to test the stability of our limited scheme.

\sidetitle{ABC-Flow}
%\subsection{ABC-Flow}
We use the Arnold–Beltrami–Childress (\textsc{abc}) flow as a simple example of a three-dimensional scenario~\cite{tavelli2016staggered}.
This scenario has, unlike the three-dimensional version of the Taylor-Green vortex, at least for the incompressible case an analytical solution
\begin{align}
  \label{eq:abc-flow}
  \begin{split}
  \Qrho(\bm{x}, t) &= 1\\
  \Qv(\bm{x}, t) &= \phantom{-} \exp(-1\mu t)
  \begin{pmatrix}
    \sin(z) + \cos(y)\\
    \sin(x) + \cos(z)\\
    \sin(y) + \cos(x)
  \end{pmatrix} \\
  \pressure(\bm{x}, t) &= -\exp(-2 \mu t) \, \left(\cos(x)\sin(y) + \sin(x)\cos(z) + \sin(z)\cos(y)\right)
  + C
  \end{split}
\end{align}
\todo{Analytical solution!}
\todo{What is $c = 100 / \gamma$? Smaller value should be possible.}

\sidetitle{Radialsymmetric CJ Detonation Wave}
%\subsection{Radialsymmetric CJ Detonation Wave}
We investigate the radialsymmetric CJ detonation wave scenario from~\cite{helzel2000modified}.
This scenario for the reactive Euler-equations is set up in a 2D box of size $[-1, 1] \times [-1, 1]$ surrounded by no-slip walls~\pcref{eq:no-slip}.
Inside a circle of radius $0.3$ we have totally unburnt gas, outside of this circle we have burned gas.
Let $\alpha =  \operatorname{atan2}(y,x)$ be the angle in polar coordinates.
We use the initial conditions
\begin{equation}
\begin{alignedat}{6}
  & \Qrho_u &&= 0.887565 \qquad& \Qrho_b &= 1.4\\
  & \Qv_u &&= -0.577350
  \begin{pmatrix}
     \cos (\alpha)\\
     \sin (\alpha)
   \end{pmatrix}  \qquad& \Qv_b  &=
   \begin{pmatrix}
     0 \\
     0
   \end{pmatrix}\\
   & \pressure_u &&=0.191709 \qquad& \pressure_b &= 1\\
   & \QZZ_u &&= 1 \quad& \QZZ_b &= 0
  \end{alignedat}
\end{equation}
where a subscript of $u$ and $b$ denotes the unburnt and burnt state respectively.

Similar to~\cite{helzel2000modified}, we use the constants
\begin{align}
  \begin{split}
  \gamma &= 1.4, \\
  \Pr &= 0.75, \\
  c_v &= 2.5, \\
  c_p &= 3.5, \\
  R &= 1.0.
  \end{split}
\end{align}
The Prandtl number is inspired from the viscous scenarios of~\cite{hidalgo2011ader}.

\section{Atmospheric Scenarios}
The following scenarios are all described in terms of a pertubation of a balanced atmosphere.
This balanced atmosphere is called hydrostatic balance and is described by \cref{eq:hydrostatic-balance}.
Before we are able to describe individual scenarios, we first need to describe how we can initialize the background atmosphere.

For this, the potential temperature $\potT$
\begin{equation}
  \potT = T \frac{p_0}{p}^{R/c_p},
\end{equation}
is useful.
The constant $p_o = \SI{10e5}{\Pa}$ is the reference pressure,.
Solving for $T$ leads to
\begin{equation}
  \label{eq:potTToT}
  T = \potT (\frac{p}{p_0})^{R/c_p}.
\end{equation}
To allow for an easier description of the initial conditions we split the $\potT$ into a background state $\backgroundPotT$ and a pertubation $\pertubationPotT$
\begin{equation}
  \label{eq:potT-split}
  \potT = \backgroundPotT + \pertubationPotT.
\end{equation}

The initial conditions for pressure and density can be computed directly from the \textsc{pde} once few assumptions have been given.
We assume that $\backgroundPotT$ is constant over the entire domain.
Inserting the definition of potential temperature, given by \cref{eq:potTToT}, into the equation of state (see \cref{eq:eos}) leads us to
\begin{equation}
  \pressure(z) = \Qrho(z) R {\left( \backgroundPotT \frac{p}{p_0}\right)}^{R/c_p},
\end{equation}
which we solve for $p(z)$.
After some algebra and simplifying, we arrive at
\begin{equation}
 p(z) = p_0 \left( \frac{R \backgroundPotT \rho(z)}{p_0} \right)^{\gamma},
\end{equation}
or equivalently
\begin{equation}
  \label{eq:eos-potT}
\Qrho(z) = \frac{p_{0}^{\frac{R}{c_{p}}} p^{\frac{1}{\gamma}}{\left (z \right )}}{R \backgroundPotT}.
\end{equation}
We want to consider flow in hydrostatic equilibrium, i.e.\ flow where the force originating from the pressure-gradient is exactly balanced by gravitation.
Inserting this assumption in the momentum equation in $z$-direction and using \cref{eq:eos} once again, we arrive at the ordinary differential equation (\textsc{ode})
\begin{align}
  \label{eq:hydrostatic-balance-potT}
  \begin{split}
  \frac{d}{d z} p{\left (z \right )} &= -g \Qrho(z)
                                     = 
        - \frac{g p_{0}^{\frac{R}{c_{p}}} p^{\frac{1}{\gamma}}{\left (z \right )}}{R \backgroundPotT}\\
  p{\left (0 \right )} &= p_0
  \end{split}
\end{align}
where we use the reference pressure $p_0$ as the pressure on ground level\todo{Refer to hydrostatic balance eq.\ in methods chapter!\cref{eq:hydrostatic-balance}}.
This \textsc{ode} can be now simply solved by separation of variables.
We then obtain after simplifying the solution
\begin{align}
  \label{eq:hydrostatic-background-pressure}
p(z) &= \left(\left(1 - \frac{1}{\gamma}\right) \left(C - \frac{g p_{0}^{\frac{R}{c_{p}}} z}{R \backgroundPotT}\right)\right)^{\frac{c_{p}}{R}},\\
\shortintertext{with constant of integration}
 C &= \frac{c_{p} p_{0}^{\frac{R}{c_{p}}}}{R}.
\end{align}

We can now compute the initial conditions for a scenario where the background potential energy is in hydrostatic equilbrium with a pertubation that is not in equilbrium.
We first compute the background pressure with background potential temperature $\backgroundPotT = \text{const.}$ using \cref{eq:hydrostatic-background-pressure}.
Next, we compute the pertubated potential temperature $\potT$ and use \cref{eq:potTToT} to convert it to temperature.
The density $\Qrho(\bm{x})$ can now be evaluated with \cref{eq:temperature}.
Finally, we compute the energy by inserting pressure and density into the equation of state~(\ref{eq:eos}).

\sidetitle{Hydrostatic Wall}
This leaves us with one problem:
The adiabatic free-slip boundary conditions defined by~\vref{eq:free-slip} are no longer valid.
Concretely, we need to impose a viscous heat flux to ensure that the atmosphere stays in hydrostatic balance~\cite{giraldo2008study}
\todo{Flux correct? Use viscFlux macro and energy subscript. Also only in z direction!}
\begin{equation}
  \label{eq:atmosphere-bc}
  F^\text{visc} = \kappa \pdv{\overline{T}}{z} =
\kappa \frac{R \overline{\theta} \left(\frac{\overline{p}{\left (z \right )}}{p_{0}}\right)^{\frac{R}{c_{p}}} \frac{d}{d z} \overline{p}{\left (z \right )}}{c_{p} \overline{p}{\left (z \right )}}.
\end{equation}
The background pressure can be reconstructed by \cref{eq:hydrostatic-background-pressure}, its derivative is given by \cref{eq:hydrostatic-balance-potT}.
We set the other parts of the viscous flux to zero.

We use the following set of fluid dependent constants for these scenarios
\begin{align}
  \begin{split}
    \gamma &= 1, \\
    \Pr &=  0.71, \\
    R &= 287.058, \\
    p_0 &= 10000,
  \end{split}
\end{align}
the other constants are evaluated following \cref{eq:fluid-constants}.

\sidetitle{Two Bubbles}
%\subsection{Two Bubbles}
As a simple test case we consider a scenario where we have one large warm air bubble in the middle, and a small cold bubble on the top.
This scenario was first published by \citeauthor{robert1993bubble}~\cite{robert1993bubble}.
We use a domain of $\SI{1}{\km} \times \SI{1}{\km}$.
The initial conditions of the scenario are given by a pertubation of a hydrostatic equlibrium.
We use a background potential temperature of $\backgroundPotT = 300$.

Let
\begin{equation}
  \label{eq:radius}
  r^2 = (x - x_0)^2 + (z - z_0)^2
\end{equation}
denote the difference between spatial positions $x,z$ and the center of a bubble $x_c, z_c$.
The pertubation is given by the function
\begin{equation}
  \label{eq:bubbles-pertubation}
  \pertubationPotT =
  \begin{cases}
    A & r \leq a \\
    A \exp \left( - (r-a)^2/s^2 \right) & r > a,
    \end{cases}
\end{equation}
where $A$ denotes the maximal pertubation, $a$ is the size of the bubble and $s$ is the decay rate.
We have two bubbles, with the values
\begin{equation}
  \label{eq:bubbles-values}
\begin{alignedat}{6}
  & \text{warm:} \qquad && A = 0.5 \quad&& a = \SI{150}{\m} \quad&& s = \SI{50}{\m} \quad&& x_c = \SI{500}{\m} \quad&& z_c = \SI{300}{\m},\\
  & \text{cold:} \qquad && A = -0.15 \quad&& a = \SI{0}{\m} \quad&& s = \SI{50}{\m} \quad&& x_c = \SI{560}{\m} \quad&& z_c = \SI{640}{\m}.
  \end{alignedat}
\end{equation}

Similar to~\cite{muller2010adaptive}, we use a constant viscosity of $\mu = 0.1$ to regularize the solution.

\sidetitle{Cosine Bubble}
%\subsection{Cosine Bubble}
A similar scenario is the cosine bubble as described in~\cite{giraldo2008study}.
In this scenario the flow is driven by one warm bubble.
We use the same procedure as before to compute the initial conditions, again with $\backgroundPotT = 300$ but with a pertubation of the form
\begin{align}
  \label{eq:cos-pertubation}
  \pertubationPotT &= \begin{cases}
    \nicefrac{A}{2} \left[ 1 + \cos(\pi r) \right] & r \leq a \\
    0 & r > a
    \end{cases}
\end{align},
where $r$ again is the radius to the center~\pcref{eq:radius} and constants
\begin{equation}\label{eq:density-bubble}
  A = 0.5 \quad a = \SI{250}{\m} \quad x_c = \SI{500}{\m} \quad z_c = \SI{350}{\m}.
\end{equation}
Similar to the previous scenario, we use a constant viscosity of $\mu = 0.1$\todo{Are we? Check~\cite{giraldo2008study}!}.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../main"
%%% End:
